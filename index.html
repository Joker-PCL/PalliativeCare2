<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <base target="_top" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js"></script>

    <!-- fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Kodchasan:ital,wght@0,200;0,300;0,400;0,500;0,600;0,700;1,200;1,300;1,400;1,500;1,600;1,700&display=swap"
      rel="stylesheet"
    />

    <!-- Data tables -->
    <script src="https://code.jquery.com/jquery-3.7.1.js"></script>
    <link rel="stylesheet" href="https://cdn.datatables.net/2.2.2/css/dataTables.dataTables.css" />
    <script src="https://cdn.datatables.net/2.2.2/js/dataTables.js"></script>

    <!-- MCDatepicker -->
    <link href="https://cdn.jsdelivr.net/npm/mc-datepicker/dist/mc-calendar.min.css" rel="stylesheet" />
    <script src="https://cdn.jsdelivr.net/npm/mc-datepicker/dist/mc-calendar.min.js"></script>

    <!-- CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.min.css" />
    <link href="https://cdn.jsdelivr.net/npm/remixicon@2.5.0/fonts/remixicon.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" />
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link rel="stylesheet" href="style.css" />
    <link rel="stylesheet" href="style2.css" />
    <link rel="stylesheet" href="table.css" />
  </head>

  <body>
    <div id="mainContent">
      <!-- แถบนำทาง, เมนู -->
      <div class="sidebar position-fixed top-0 bottom-0 bg-white border-end">
        <div class="d-flex align-items-center pt-3 px-3">
          <a class="navbar-brand text-uppercase">
            <img src="https://lh5.googleusercontent.com/d/1ybmhWW4uQhjBZyn97ahAMnmI2XTB8bIG" alt="Bootstrap" width="50" height="50" />
            <span class="sidebar-dropdown-menu-text">Pilliative Care</span>
          </a>
          <i class="sidebar-toggle ri-arrow-left-circle-line ms-auto fs-2 d-none d-md-block"></i>
        </div>
        <ul class="sidebar-menu p-3 m-0 mb-0">
          <!-- หน้าหลัก -->
          <li class="sidebar-menu-item has-dropdown active list-menu-page" data-main-page-id="homepage">
            <a href="#">
              <i class="bi bi-house-door-fill sidebar-menu-item-icon"></i>
              <span class="sidebar-dropdown-menu-text">หน้าหลัก</span>
            </a>
          </li>
          <li class="sidebar-menu-divider mt-3 mb-1 text-uppercase">รายการบันทึก</li>

          <section class="section-user-data">
            <!-- ข้อมูลผู้ป่วย -->
            <li class="sidebar-menu-item has-dropdown mb-2">
              <a href="#">
                <i class="bi bi-person-lines-fill sidebar-menu-item-icon"></i>
                <span class="sidebar-dropdown-menu-text">ข้อมูลผู้ป่วย</span>
                <i class="ri-arrow-down-s-line sidebar-menu-item-accordion ms-auto"></i>
              </a>
              <ul class="sidebar-dropdown-menu" style="display: none">
                <li
                  class="sidebar-dropdown-menu-item list-menu-page"
                  data-main-page-id="patientInformation"
                  data-child-page-id="patientInformation_1"
                >
                  <a href="#"> ข้อมูลทั่วไป </a>
                </li>
                <li
                  class="sidebar-dropdown-menu-item list-menu-page"
                  data-main-page-id="patientInformation"
                  data-child-page-id="patientInformation_2"
                >
                  <a href="#"> Consult for </a>
                </li>
                <li
                  class="sidebar-dropdown-menu-item list-menu-page"
                  data-main-page-id="patientInformation"
                  data-child-page-id="patientInformation_3"
                >
                  <a href="#"> ข้อมูลสภาวะสุขภาพ </a>
                </li>
              </ul>
            </li>
            <!-- การดูแลรักษา -->
            <li class="sidebar-menu-item has-dropdown mb-2">
              <a href="#">
                <i class="bi bi-clipboard2-pulse-fill sidebar-menu-item-icon"></i>
                <span class="sidebar-dropdown-menu-text">การดูแลรักษา</span>
                <i class="ri-arrow-down-s-line sidebar-menu-item-accordion ms-auto"></i>
              </a>
              <ul class="sidebar-dropdown-menu" style="display: none">
                <li class="sidebar-dropdown-menu-item list-menu-page" data-main-page-id="treatment" data-child-page-id="treatment_1">
                  <a href="#">Family meeting, Advance care plan</a>
                </li>
                <li class="sidebar-dropdown-menu-item list-menu-page" data-main-page-id="treatment" data-child-page-id="treatment_2">
                  <a href="#">Treatment</a>
                </li>
                <li class="sidebar-dropdown-menu-item list-menu-page" data-main-page-id="treatment" data-child-page-id="treatment_3">
                  <a href="#">Education&training programs</a>
                </li>
              </ul>
            </li>
            <!-- วางแผนจำหน่าย  -->
            <li class="sidebar-menu-item has-dropdown mb-2">
              <a href="#">
                <i class="bi bi-calendar-week sidebar-menu-item-icon"></i>
                <span class="sidebar-dropdown-menu-text">วางแผนจำหน่าย </span>
                <i class="ri-arrow-down-s-line sidebar-menu-item-accordion ms-auto"></i>
              </a>
              <ul class="sidebar-dropdown-menu" style="display: none">
                <li class="sidebar-dropdown-menu-item list-menu-page" data-main-page-id="planning" data-child-page-id="planning_1">
                  <a href="#">ติดตามประเมินอาการ, ให้คำปรึกษาตลอด 24 ชม.</a>
                </li>
                <li class="sidebar-dropdown-menu-item list-menu-page" data-main-page-id="planning" data-child-page-id="planning_2">
                  <a href="#">เยี่ยมบ้าน,ส่งต่อเครือข่าย</a>
                </li>
              </ul>
            </li>
            <!-- การดูแลหลังเสียชีวิต   -->
            <li class="sidebar-menu-item has-dropdown mb-2">
              <a href="#">
                <i class="bi bi-search-heart sidebar-menu-item-icon"></i>
                <span class="sidebar-dropdown-menu-text">การดูแลหลังเสียชีวิต</span>
                <i class="ri-arrow-down-s-line sidebar-menu-item-accordion ms-auto"></i>
              </a>
              <ul class="sidebar-dropdown-menu" style="display: none">
                <li class="sidebar-dropdown-menu-item list-menu-page" data-main-page-id="bereavementCare" data-child-page-id="bereavementCare_1">
                  <a href="#">ประเมิน 2Q,9Q,8Q,BGQ good death,ความพึงพอใจ</a>
                </li>
              </ul>
            </li>
          </section>
          <!-- จัดการระบบ (Admin) -->
          <li id="adminMenu" class="sidebar-menu-item has-dropdown mb-2 admin-only">
            <a href="#">
              <i class="bi bi-person-fill-gear sidebar-menu-item-icon"></i>
              <span class="sidebar-dropdown-menu-text">จัดการระบบ (Admin)</span>
              <i class="ri-arrow-down-s-line sidebar-menu-item-accordion ms-auto"></i>
            </a>
            <ul class="sidebar-dropdown-menu" style="display: none">
              <li class="sidebar-dropdown-menu-item">
                <a href="https://script.google.com/macros/s/AKfycbwMK_f0UTvBFciKnCaETEdGSGBRNqpSVX1IeHR_ELx4/dev?page=EditUser">จัดการผู้ใช้งาน</a>
              </li>
              <li class="sidebar-dropdown-menu-item">
                <a href="#" onclick="showSettingsModal(); return false;">ตั้งค่าระบบ</a>
              </li>
            </ul>
          </li>
        </ul>
      </div>

      <div class="sidebar-overlay"></div>

      <main class="bg-light pb-5">
        <!-- Navbar -->
        <div class="px-3">
          <nav class="navbar rounded-bottom navbar-expand-lg navbar-light bg-primary shadow-sm">
            <div class="container-fluid">
              <button
                class="navbar-toggler border-0 d-lg-none"
                type="button"
                data-bs-toggle="collapse"
                data-bs-target="#sidebar"
                aria-controls="sidebar"
                aria-expanded="false"
              >
                <i class="ri-menu-line sidebar-toggle me-3 d-block d-md-none text-white"></i>
              </button>

              <a
                class="navbar-brand mx-auto fs-3 fw-bold text-white"
                href="https://script.google.com/macros/s/AKfycbwMK_f0UTvBFciKnCaETEdGSGBRNqpSVX1IeHR_ELx4/dev"
              >
                DASHBOARD
              </a>

              <!-- เมนูโปรไฟล์ -->
              <div class="d-flex align-items-center">
                <div class="dropdown">
                  <a
                    class="nav-link dropdown-toggle d-flex align-items-center"
                    href="#"
                    id="userDropdown"
                    role="button"
                    data-bs-toggle="dropdown"
                    aria-expanded="false"
                  >
                    <img
                      class="profile-image rounded-circle me-2"
                      src="https://lh5.googleusercontent.com/d/1Gusc9uPNULQQxps9Uee8rZajweC7X8HN"
                      alt="รูปโปรไฟล์"
                      style="width: 50px; height: 50px; object-fit: cover"
                    />
                  </a>

                  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="userDropdown">
                    <li>
                      <a
                        class="dropdown-item"
                        href="https://script.google.com/macros/s/AKfycbwMK_f0UTvBFciKnCaETEdGSGBRNqpSVX1IeHR_ELx4/dev?page=profile"
                        ><i class="ri-user-settings-line me-2"></i>จัดการโปรไฟล์</a
                      >
                    </li>
                    <li>
                      <a
                        class="dropdown-item"
                        href="https://script.google.com/macros/s/AKfycbwMK_f0UTvBFciKnCaETEdGSGBRNqpSVX1IeHR_ELx4/dev?page=report"
                        ><i class="ri-file-list-3-line me-2"></i>จัดการข้อมูล</a
                      >
                    </li>
                    <li><hr class="dropdown-divider" /></li>
                    <li>
                      <a class="dropdown-item" href="#" onclick="handleLogout(); return false;"
                        ><i class="ri-logout-box-r-line me-2"></i>ออกจากระบบ</a
                      >
                    </li>
                  </ul>
                </div>
              </div>
            </div>
          </nav>
        </div>

        <!-- หน้าหลัก, หน้าย่อย -->
        <div class="container-xxl">
          <!-- หน้าแรก,ตาราง -->
          <div id="homepage" class="main-page mt-5">
            <!-- สรุปข้อมูล -->
            <div class="row row-cols-1 row-cols-sm-2 row-cols-md-2 row-cols-xl-4 mb-4">
              <div class="col d-flex">
                <div class="card status-card bg-total text-white flex-fill">
                  <div class="card-body d-flex flex-column">
                    <div class="d-flex align-items-center">
                      <div class="status-icon">
                        <i class="bi bi-boxes fs-3"></i>
                      </div>
                      <div class="ms-3">
                        <div class="status-label">คนใข้ทั้งหมด</div>
                        <div class="status-value" id="totalRequests">0</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="col d-flex">
                <div class="card status-card bg-approved text-white flex-fill">
                  <div class="card-body d-flex flex-column">
                    <div class="d-flex align-items-center">
                      <div class="status-icon">
                        <i class="bi bi-clock fs-3"></i>
                      </div>
                      <div class="ms-3">
                        <div class="status-label">รอดำเนินการ</div>
                        <div class="status-value" id="approvedRequests">0</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="col d-flex">
                <div class="card status-card bg-pending text-white flex-fill">
                  <div class="card-body d-flex flex-column">
                    <div class="d-flex align-items-center">
                      <div class="status-icon">
                        <i class="bi bi-ban fs-3"></i>
                      </div>
                      <div class="ms-3">
                        <div class="status-label">ปฏิเสธ</div>
                        <div class="status-value" id="pendingRequests">0</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <div class="col d-flex">
                <div class="card status-card bg-completed text-white flex-fill">
                  <div class="card-body d-flex flex-column">
                    <div class="d-flex align-items-center">
                      <div class="status-icon">
                        <i class="bi bi-flag-fill fs-3"></i>
                      </div>
                      <div class="ms-3">
                        <div class="status-label">สำเร็จ</div>
                        <div class="status-value" id="completedRequests">0</div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- กรองข้อมูล -->
            <div class="card shadow-sm mb-4">
              <div class="bg-header text-white rounded-sm col-sm-12 px-4 mb-2 py-3 d-flex justify-content-between align-items-center">
                <h5 class="card-title fw-bold mb-0">รายการข้อมูลทั้งหมด</h5>
                <div class="d-flex gap-3">
                  <button class="btn btn-cancel" id="reset_filter"><i class="bi bi-arrow-clockwise pe-1"></i>รีเซ็ต</button>
                  <button class="btn btn-add" id="add_patient_data" data-bs-toggle="modal" data-bs-target="#register_patient_form_modal">
                    <i class="bi bi-plus-circle pe-1"></i>เพิ่มข้อมูล
                  </button>
                </div>
              </div>

              <div class="card-body">
                <div class="row g-3">
                  <!-- กรองข้อมูลทั้งตาราง -->
                  <div class="col-md-8">
                    <div class="input-group">
                      <span class="input-group-text bg-light border-end-0">
                        <i class="bi bi-search"></i>
                      </span>
                      <input type="search" class="table_filter form-control" id="searchDataTable" placeholder="ค้นหารายการ..." />
                    </div>
                  </div>
                  <!-- กรองข้อมูลคลอลั่ม สถานะ -->
                  <div class="col-md-4" id="filter_col3" data-column="3">
                    <select class="column_filter_same form-select" id="col3_filter">
                      <option value="">สถานะทั้งหมด</option>
                      <option value="รอดำเนินการ">รอดำเนินการ</option>
                      <option value="อนุมัติ">อนุมัติ</option>
                      <option value="ปฏิเสธ">ปฏิเสธ</option>
                      <option value="เสร็จสิ้น">เสร็จสิ้น</option>
                    </select>
                  </div>

                  <!-- กรองข้อมูลคลอลั่ม วันที่เข้ารับบริการ -->
                  <div class="col-sm-6">
                    <div class="input-group">
                      <span class="input-group-text bg-light border-end-0">
                        <i class="bi bi-calendar-range"></i>
                      </span>
                      <input type="text" class="form-control mc-date-picker" id="service_start_date" placeholder="วันที่เริ่มต้น..." readonly />
                    </div>
                  </div>
                  <div class="col-sm-6">
                    <div class="input-group">
                      <span class="input-group-text bg-light border-end-0">
                        <i class="bi bi-calendar-range"></i>
                      </span>
                      <input type="text" class="form-control mc-date-picker" id="until_the_date_of_service" placeholder="ถึงวันที่..." readonly />
                    </div>
                  </div>
                </div>
              </div>
              <hr />
              <!-- ตารางข้อมูล -->
              <div class="data-table px-3">
                <table id="main_user_data_table" class="table-responsive nowrap" style="width: 100%">
                  <thead>
                    <tr class="data-table-row">
                      <th></th>
                      <th>วันที่เข้ารับบริการ</th>
                      <th>การดำเนินการ</th>
                      <th>ชื่อ-สกุล</th>
                      <th>เลขบัตรประชาชน</th>
                      <th>เพศ</th>
                      <th>อายุ</th>
                    </tr>
                  </thead>
                  <tbody>
                    <tr class="data-table-row">
                      <td>
                        <img class="profile-table" src="https://lh5.googleusercontent.com/d/1wnYXEcQNqUTJ15WL9Hck79IIf48QNU5k" alt />
                      </td>
                      <td>20/02/2025, 20:16</td>
                      <td><span class="approve approve-approved">อนุมัติ</span></td>
                      <td>นาย ประยุทธ์ จันโทรลา</td>
                      <td>1450587369915</td>
                      <td>ชาย</td>
                      <td>64 ปี</td>
                    </tr>
                    <tr class="data-table-row">
                      <td>
                        <img class="profile-table" src="https://lh5.googleusercontent.com/d/14JrOi6I2qanUTFn4Q_ftHDDkrGGSw8iV" alt />
                      </td>
                      <td>21/02/2025, 17:10</td>
                      <td><span class="approve approve-pending">รอดำเนินการ</span></td>
                      <td>นาย ทักษิน อินนะวัตร</td>
                      <td>7369915145058</td>
                      <td>ชาย</td>
                      <td>83 ปี</td>
                    </tr>
                    <tr class="data-table-row">
                      <td>
                        <img class="profile-table" src="https://lh5.googleusercontent.com/d/16fpYWqjNrk2cg0EW3LlSO6HZh673-4ht" alt />
                      </td>
                      <td>22/02/2025, 21:16</td>
                      <td><span class="approve approve-refuse">ปฏิเสธ</span></td>
                      <td>นาย ประวิตร จันโทรลา</td>
                      <td>7369915145058</td>
                      <td>ชาย</td>
                      <td>71 ปี</td>
                    </tr>
                    <tr class="data-table-row">
                      <td>
                        <img class="profile-table" src="https://lh5.googleusercontent.com/d/16fpYWqjNrk2cg0EW3LlSO6HZh673-4ht" alt />
                      </td>
                      <td>22/02/2025, 21:16</td>
                      <td><span class="approve approve-cancel">ยกเลิก</span></td>
                      <td>นาย ประวิตร จันโทรลา</td>
                      <td>7369915145058</td>
                      <td>ชาย</td>
                      <td>71 ปี</td>
                    </tr>
                  </tbody>
                </table>
              </div>
            </div>
          </div>

          <section id="patient_history" style="display: block">
            <!-- ข้อมูลผู้ป่วย -->
            <div id="patientInformation" class="main-page mt-5">
              <!-- ปุ่มเมนูข้อมูลผู้ป่วย -->
              <div class="row row-cols-1 row-cols-sm-2 row-cols-md-2 row-cols-xl-3">
                <div class="col d-flex">
                  <div class="card status-card bg-total text-white btn-menu-child-page flex-fill" data-child-page-id="patientInformation_1">
                    <div class="card-body d-flex flex-column">
                      <div class="d-flex align-items-center">
                        <div class="status-icon">
                          <img src="https://lh5.googleusercontent.com/d/1_4bqt5irDAlX6ZBK2lETH_JbqHfDvqvg" alt="consult" />
                        </div>
                        <div class="ms-3">
                          <div class="status-label">ข้อมูลทั่วไปของผู้ป่วย</div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="col d-flex">
                  <div class="card status-card bg-pending text-white btn-menu-child-page flex-fill" data-child-page-id="patientInformation_2">
                    <div class="card-body d-flex flex-column">
                      <div class="d-flex align-items-center">
                        <div class="status-icon">
                          <img src="https://lh5.googleusercontent.com/d/1bJahWI91zSmTwTc4M7NW6kQ71BM-HWMw" alt="consult" />
                        </div>
                        <div class="ms-3">
                          <div class="status-label">Consult for</div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="col d-flex">
                  <div class="card status-card bg-approved text-white btn-menu-child-page flex-fill" data-child-page-id="patientInformation_3">
                    <div class="card-body d-flex flex-column">
                      <div class="d-flex align-items-center">
                        <div class="status-icon">
                          <img src="https://lh5.googleusercontent.com/d/1B49xnjh4CsYad7rDuQiIGm9kcw_Ame3S" alt="health-report" />
                        </div>
                        <div class="ms-3">
                          <div class="status-label">ข้อมูลสภาวะสุขภาพ</div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- ข้อมูลทั่วไปของผู้ป่วย -->
              <div id="patientInformation_1" class="child-page active px-3 my-3">
                <button
                  id="edit_patientInformation1"
                  type="button"
                  class="btn-edit"
                  data-bs-toggle="modal"
                  data-bs-target="#generalInformation_modal"
                >
                  <i class="fa-regular fa-pen-to-square" aria-hidden="true"></i>
                </button>
                <div class="profile-main pt-5">
                  <img id="patientImages" src="https://lh5.googleusercontent.com/d/1VZQfP1X7rawlEsI5BdrC9uHekPhHAkvx" alt="profile" />
                </div>
                <div class="detail">
                  <div>
                    <h4 class="text-center mb-4">ข้อมูลทั่วไปของผู้ป่วย</h4>
                    <ul>
                      <li>
                        วันที่เข้ารับบริการ:
                        <span id="serviceDate">20/01/2024, 20:16:54</span>
                      </li>
                      <li>Hn: <span id="hn">BBB</span></li>
                      <li>ชื่อ-สกุล: <span id="fullName">ตูมตาม สุกฤษฎิ์</span></li>
                      <li>
                        เลขบัตรประชาชน:
                        <span id="nationalID">1544789635887</span>
                      </li>
                      <li>วันเกิด: <span id="birthday">18/06/1870</span></li>
                      <li>อายุ: <span id="age">75</span></li>
                      <li>ศาสนา: <span id="religion">พุทธ</span></li>
                      <li>เพศ: <span id="gender">ชาย</span></li>
                      <li>น้ำหนัก: <span id="weight">65</span></li>
                      <li>ส่วนสูง: <span id="height">168</span></li>
                      <li>
                        สิทธิ์การรักษา:
                        <span id="rightToTreatment">ประกันสังคม</span>
                      </li>
                      <li>เบอร์โทรติดต่อ: <span id="tel">0997548116</span></li>
                      <li>
                        ที่อยู่:
                        <span id="address">111/11 ตำบลบางพลีใหญ่ อำเภอบางพลี จังหวัดสมุทรปราการ 10540</span>
                      </li>
                      <li>
                        วันที่ admit:
                        <span id="startAdmitDate">15/06/2024</span> ถึง
                        <span id="finishAdmitDate">31/10/2024</span>
                      </li>
                      <li>
                        ความคิดเห็นของแพทย์:
                        <span id="doctorOpinion">XXXXX</span>
                      </li>
                    </ul>
                  </div>
                </div>

                <section class="photo-gallery mb-5 mx-3">
                  <div class="container">
                    <div class="row row-cols-1 row-cols-md-2 row-cols-xl-3 gx-5 gy-4">
                      <div class="col photo-history photo-preview">
                        <img
                          id="patientPicture1"
                          src="https://lh5.googleusercontent.com/d/16jxzdJ7eT0hbOZ2KG3s6-AgaFfpK0lFT"
                          alt="Lorem ipsum dolor sit amet"
                        />
                      </div>
                      <div class="col photo-history photo-preview">
                        <img
                          id="patientPicture2"
                          src="https://lh5.googleusercontent.com/d/1QeA1R8azZkNlCiHY1AHPXjUtI9rCXPG2"
                          alt="Ipsum lorem dolor sit amet"
                        />
                      </div>
                      <div class="col photo-history photo-preview">
                        <img
                          id="patientPicture3"
                          src="https://lh5.googleusercontent.com/d/1Gi9HPonxFh-6n782ngJ4A4o-0bhLO7hJ"
                          alt="Dolor lorem ipsum sit amet"
                        />
                      </div>
                      <div class="col photo-history photo-preview">
                        <img
                          id="patientPicture4"
                          src="https://lh5.googleusercontent.com/d/1Gi9HPonxFh-6n782ngJ4A4o-0bhLO7hJ"
                          alt="Sit amet lorem ipsum dolor"
                        />
                      </div>
                    </div>
                  </div>
                </section>
              </div>

              <!-- Consult for -->
              <div id="patientInformation_2" class="child-page px-3 my-3">
                <button id="edit_patientInformation2" type="button" class="btn-edit" data-bs-toggle="modal" data-bs-target="#consultFor_modal">
                  <i class="fa-regular fa-pen-to-square" aria-hidden="true"></i>
                </button>
                <div class="child-page-icon pt-5">
                  <img src="https://lh5.googleusercontent.com/d/1bJahWI91zSmTwTc4M7NW6kQ71BM-HWMw" alt="consult" />
                </div>
                <div class="detail">
                  <div>
                    <h4 class="text-center mb-4">Consult for</h4>
                    <ul>
                      <li>
                        Advance care plant:
                        <span id="advanceCarePlant">A</span>
                      </li>
                      <li>
                        Best suportive care:
                        <span id="bestSuportiveCare">B</span>
                      </li>
                      <li>
                        End of life care:
                        <span id="endOfLifeCareIPD_EOL">EOL care at home(home visit)</span>
                      </li>
                      <li>
                        Skill training for home care at EOL:
                        <span id="skillTrainingForHomeCareAtEOL">D</span>
                      </li>
                      <li>
                        Socioeconomic &amp; spiritual problem:
                        <span id="socioeconomicAndSpiritualProblem"></span>
                      </li>
                      <li>
                        Medical equipment lending:
                        <span id="medicalEquipmentLending"></span>
                      </li>
                      <li>
                        หน่วยที่ส่งปรึกษา (หอผู้ป่วย, OPD):
                        <span id="consultationUnit"></span>
                      </li>
                      <li>
                        แพทย์ที่ส่งปรึกษา:
                        <span id="referringPhysician"></span>
                      </li>
                    </ul>
                  </div>
                </div>
              </div>

              <!-- ข้อมูลสภาวะสุขภาพ -->
              <div id="patientInformation_3" class="child-page px-3 my-3">
                <button id="edit_patientInformation3" type="button" class="btn-edit" data-bs-toggle="modal" data-bs-target="#healthInformation_modal">
                  <i class="fa-regular fa-pen-to-square" aria-hidden="true"></i>
                </button>
                <div class="child-page-icon pt-5">
                  <img src="https://lh5.googleusercontent.com/d/1B49xnjh4CsYad7rDuQiIGm9kcw_Ame3S" alt="health-report" />
                </div>
                <div class="detail">
                  <div>
                    <h4 class="text-center mb-4">ข้อมูลสภาวะสุขภาพ</h4>
                    <ul>
                      <li>Diagnosis: <span id="diagnosis"></span></li>
                      <li>
                        ผู้ป่วย Palliative care แยกตามโรค:
                        <span id="patientsByDisease"></span>
                      </li>
                      <li>
                        Chief compaint:
                        <span id="chiefCompaint"></span>
                      </li>
                      <li>
                        Status/Underlying disease:
                        <span id="statusUnderlyingDisease"></span>
                      </li>
                      <li>PPS: <span id="pps"></span></li>
                      <li>
                        Biological problem:
                        <span id="biologicalProblem"></span>
                      </li>
                      <li>
                        Psychosocial:
                        <span id="psychosocial"></span>
                      </li>
                      <li>Spiritual: <span id="spiritual"></span></li>
                      <li>
                        แบบประเมิน PPS:
                        <span id="ppsAssessment"></span>
                      </li>
                      <li>
                        แบบประเมินอาการรบกวน ESAS:
                        <span id="esasAssessment"></span>
                      </li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>

            <!-- การดูแลรักษา -->
            <div id="treatment" class="main-page mt-5">
              <!-- ปุ่มเมนูการดูแลรักษา -->
              <div class="row row-cols-1 row-cols-sm-2 row-cols-md-2 row-cols-xl-3">
                <div class="col d-flex">
                  <div class="card status-card bg-total text-white btn-menu-child-page flex-fill" data-child-page-id="treatment_1">
                    <div class="card-body d-flex flex-column">
                      <div class="d-flex align-items-center">
                        <div class="status-icon">
                          <img src="https://lh5.googleusercontent.com/d/1R-_lfnIviohWmYXWK9l3i8K0I-S0oLol" alt="consult" />
                        </div>
                        <div class="ms-3">
                          <div class="status-label">Family meeting, Advance care plan</div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="col d-flex">
                  <div class="card status-card bg-pending text-white btn-menu-child-page flex-fill" data-child-page-id="treatment_2">
                    <div class="card-body d-flex flex-column">
                      <div class="d-flex align-items-center">
                        <div class="status-icon">
                          <img src="https://lh5.googleusercontent.com/d/17d-ZvzrG2wzbriB2e7yx7TKt3NXzEw4n" alt="consult" />
                        </div>
                        <div class="ms-3">
                          <div class="status-label">Treatment</div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="col d-flex">
                  <div class="card status-card bg-approved text-white btn-menu-child-page flex-fill" data-child-page-id="treatment_3">
                    <div class="card-body d-flex flex-column">
                      <div class="d-flex align-items-center">
                        <div class="status-icon">
                          <img src="https://lh5.googleusercontent.com/d/1JL0sk1J0s5sUpp3VYDfYNAMrTT9yCtq5" alt="health-report" />
                        </div>
                        <div class="ms-3">
                          <div class="status-label">Education&training programs</div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- Family meeting, Advance care plan -->
              <div id="treatment_1" class="child-page px-3 my-3">
                <button id="treatment_edit1" type="button" class="btn-edit" data-bs-toggle="modal" data-bs-target="#familyMeeting_modal">
                  <i class="fa-regular fa-pen-to-square" aria-hidden="true"></i>
                </button>
                <div class="child-page-icon pt-5">
                  <img src="https://lh5.googleusercontent.com/d/1R-_lfnIviohWmYXWK9l3i8K0I-S0oLol" alt="family-meeting" />
                </div>
                <div class="detail">
                  <div>
                    <h4 class="text-center mb-4">Family meeting, Advance care plan</h4>
                    <ul>
                      <li>
                        วันที่ Family meeting:
                        <span id="meetingDate"></span>
                      </li>
                      <li>
                        การรับรู้การดำเนินการของโรค:
                        <span id="recognitionDisease"></span>
                      </li>
                      <li>
                        Living will documentation:
                        <span id="livingWillDocumentation"></span>
                      </li>
                      <li>
                        Resuscitaion plan: noETT:
                        <span id="resuscitaionPlanNoETT"></span>
                      </li>
                      <li>
                        Place of death:
                        <span id="placeOfDeath"></span>
                      </li>
                    </ul>
                  </div>
                </div>
              </div>

              <!-- Treatment -->
              <div id="treatment_2" class="child-page px-3 my-3">
                <button id="treatment_edit2" type="button" class="btn-edit" data-bs-toggle="modal" data-bs-target="#treatment_modal">
                  <i class="fa-regular fa-pen-to-square" aria-hidden="true"></i>
                </button>
                <div class="child-page-icon pt-5">
                  <img src="https://lh5.googleusercontent.com/d/17d-ZvzrG2wzbriB2e7yx7TKt3NXzEw4n" alt="treatment" />
                </div>
                <div class="detail">
                  <div>
                    <h4 class="text-center mb-4">Treatment</h4>
                    <ul>
                      <li>PC note: <span id="pcNote"></span></li>
                      <li>
                        ยาที่ใช้:
                        <span id="medicationsUsed"></span>
                      </li>
                      <li>
                        ปัญหาที่ต้องการแก้ไขเร่งด่วน:
                        <span id="issuesSolvedUrgently"></span>
                      </li>
                      <li>
                        แผนการดูแล/กิจกรรการดูแล:
                        <span id="carePlanCareRoutine"></span>
                      </li>
                      <li>
                        ผลลัพธ์/ข้อเสนอแนะ:
                        <span id="resultsSuggestions"></span>
                      </li>
                    </ul>
                  </div>
                </div>
              </div>

              <!-- Education&training programs -->
              <div id="treatment_3" class="child-page px-3 my-3">
                <button id="treatment_edit3" type="button" class="btn-edit" data-bs-toggle="modal" data-bs-target="#educationTraining_modal">
                  <i class="fa-regular fa-pen-to-square" aria-hidden="true"></i>
                </button>
                <div class="child-page-icon pt-5">
                  <img src="https://lh5.googleusercontent.com/d/1JL0sk1J0s5sUpp3VYDfYNAMrTT9yCtq5" alt="Education-training" />
                </div>
                <div class="detail">
                  <div>
                    <h4 class="text-center mb-4">Education&amp;training programs</h4>
                    <ul>
                      <li>Training: <span id="trainning">ญาติ</span></li>
                      <li>
                        End of life care:
                        <span id="endOfLifeCare"></span>
                      </li>
                      <li>
                        อาการที่พบได้เมื่อใกล้เสียชีวิต:
                        <span id="symptomsNearDeath"></span>
                      </li>
                      <li>
                        การผ่อนคลายร่างกายและจิตใจ:
                        <span id="relaxation"></span>
                      </li>
                      <li>
                        การพลิกตะแคงตัวจัดท่า:
                        <span id="sideFlip"></span>
                      </li>
                      <li>
                        การดูแลทางเดินหายใจ:
                        <span id="respiratoryCare"></span>
                      </li>
                      <li>
                        การดูแลผู้ป่วย On NG-tube:
                        <span id="onNgTube"></span>
                      </li>
                      <li>
                        การดูแลผู้ป่วย Retrained foley's cath:
                        <span id="retrainedFoleyCath"></span>
                      </li>
                      <li>Wond care: <span id="wondCare"></span></li>
                      <li>
                        Colostomy care:
                        <span id="colostomyCare"></span>
                      </li>
                      <li>อื่นๆ: <span id="other"></span></li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>

            <!-- วางแผนจำหน่าย  -->
            <div id="planning" class="main-page mt-5">
              <!-- ปุ่มเมนูวางแผนจำหน่าย -->
              <div class="row row-cols-1 row-cols-sm-2 row-cols-md-2 row-cols-xl-3">
                <div class="col d-flex">
                  <div class="card status-card bg-total text-white btn-menu-child-page flex-fill" data-child-page-id="planning_1">
                    <div class="card-body d-flex flex-column">
                      <div class="d-flex align-items-center">
                        <div class="status-icon">
                          <img src="https://lh5.googleusercontent.com/d/1WG05teMtGeslui4cdnhuBFHdy5FchTVH" alt="consult" />
                        </div>
                        <div class="ms-3">
                          <div class="status-label">ติดตามประเมินอาการ, ให้คำปรึกษาตลอด 24 ชม.</div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>

                <div class="col d-flex">
                  <div class="card status-card bg-pending text-white btn-menu-child-page flex-fill" data-child-page-id="planning_2">
                    <div class="card-body d-flex flex-column">
                      <div class="d-flex align-items-center">
                        <div class="status-icon">
                          <img src="https://lh5.googleusercontent.com/d/1-PI4l76uMEAGuRWjMnISGT2K37FI8IBT" alt="consult" />
                        </div>
                        <div class="ms-3">
                          <div class="status-label">เยี่ยมบ้าน,ส่งต่อเครือข่าย</div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- ติดตามประเมินอาการ, ให้คำปรึกษาตลอด 24 ชม. -->
              <div id="planning_1" class="child-page px-3 my-3">
                <button id="planning_edit1" type="button" class="btn-edit" data-bs-toggle="modal" data-bs-target="#followUp_modal">
                  <i class="fa-regular fa-pen-to-square" aria-hidden="true"></i>
                </button>
                <div class="child-page-icon pt-5">
                  <img src="https://lh5.googleusercontent.com/d/1WG05teMtGeslui4cdnhuBFHdy5FchTVH" alt="consultation" />
                </div>
                <div class="detail">
                  <div>
                    <h4 class="text-center mb-4">ติดตามประเมินอาการ, ให้คำปรึกษาตลอด 24 ชม.</h4>
                    <ul>
                      <li>
                        วันที่ติดตาม ให้คำปรึกษา/เวลา:
                        <span id="followUp_followUpDate">17/07/2024, 14:49</span>
                      </li>
                      <li>
                        PPS 50-100%:
                        <span id="followUp_pps50_100">5</span>
                      </li>
                      <li>PPS 30-40%: <span id="followUp_pps30_40">6</span></li>
                      <li>PPS 10-20%: <span id="followUp_pps10_20">7</span></li>
                      <li>PPS %: <span id="followUp_ppsPercent">8</span></li>
                      <li>ปัญหา: <span id="followUp_issue">G</span></li>
                      <li>การแก้ไข: <span id="followUp_resolve">I</span></li>
                      <li>กิจกรรการดูแล: <span id="followUp_caring">no Central line</span></li>
                    </ul>
                  </div>
                </div>
              </div>

              <!-- เยี่ยมบ้าน,ส่งต่อเครือข่าย -->
              <div id="planning_2" class="child-page px-3 my-3">
                <button id="planning_edit2" type="button" class="btn-edit" data-bs-toggle="modal" data-bs-target="#homeVisit_modal">
                  <i class="fa-regular fa-pen-to-square" aria-hidden="true"></i>
                </button>
                <div class="child-page-icon pt-5">
                  <img src="https://lh5.googleusercontent.com/d/1-PI4l76uMEAGuRWjMnISGT2K37FI8IBT" alt="home-visits" />
                </div>
                <div class="detail">
                  <div>
                    <h4 class="text-center mb-4">เยี่ยมบ้าน,ส่งต่อเครือข่าย</h4>
                    <ul>
                      <li>วันที่เยี่ยมบ้าน/เวลา:<span id="homeVisit_homeVisitDate">10/02/2025, 12:26</span></li>
                      <li>
                        เยี่ยมบ้านครั้งที่:
                        <span id="homeVisit_homeVisitNo">1</span>
                      </li>
                      <li>PPS %: <span id="homeVisit_ppsPercent">30</span></li>
                      <li>ปัญหา: <span id="homeVisit_issue">หอยเหนื่ิอย</span></li>
                      <li>การแก้ไข: <span id="homeVisit_resolve"></span></li>
                      <li>กิจกรรการดูแล: <span id="homeVisit_caring">no Central line</span></li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>

            <!-- การดูแลหลังเสียชีวิต  -->
            <div id="bereavementCare" class="main-page mt-5">
              <!-- ปุ่มเมนูวางแผนจำหน่าย -->
              <div class="row row-cols-1 row-cols-sm-2 row-cols-md-2 row-cols-xl-3">
                <div class="col d-flex">
                  <div class="card status-card bg-total text-white btn-menu-child-page flex-fill" data-child-page-id="bereavementCare_1">
                    <div class="card-body d-flex flex-column">
                      <div class="d-flex align-items-center">
                        <div class="status-icon">
                          <img src="https://lh5.googleusercontent.com/d/1jqnqB7oj9Lks6MtytU9SfMhAGV8yCZtD" alt="consult" />
                        </div>
                        <div class="ms-3">
                          <div class="status-label">ประเมิน 2Q,9Q,8Q,BGQ good death,ความพึงพอใจ</div>
                        </div>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <!-- ประเมิน 2Q,9Q,8Q,BGQ good death,ความพึงพอใจ -->
              <div id="bereavementCare_1" class="child-page px-3 my-3">
                <button id="BereavementCare_edit1" type="button" class="btn-edit" data-bs-toggle="modal" data-bs-target="#staticBackdrop">
                  <i class="fa-regular fa-pen-to-square" aria-hidden="true"></i>
                </button>
                <div class="child-page-icon pt-5">
                  <img src="https://lh5.googleusercontent.com/d/1jqnqB7oj9Lks6MtytU9SfMhAGV8yCZtD" alt="assessment" />
                </div>
                <div class="detail">
                  <div>
                    <h4 class="text-center mb-4">ประเมิน 2Q,9Q,8Q,BGQ good death,ความพึงพอใจ</h4>
                    <ul>
                      <li>Advance care plant: 20/01/2024, 20:16:54</li>
                      <li>Best suportive care:</li>
                      <li>
                        End of life care
                        <ol type="1">
                          <li>IPD EOL care at primary</li>
                          <li>EOL care at home (home visit)</li>
                        </ol>
                      </li>
                      <li>Skill training for home care at EOL</li>
                      <li>Socioeconomic &amp; spiritual problem</li>
                      <li>Medical equipment lending</li>
                      <li>หน่วยที่ส่งปรึกษา (หอผู้ป่วย, OPD)</li>
                      <li>แพทย์ที่ส่งปรึกษา</li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
          </section>
        </div>
      </main>
    </div>

    <!-- Modal -->
    <div class="modal fade" id="register_patient_form_modal" tabindex="-1" aria-labelledby="formModalLabel" aria-hidden="true">
      <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
          <div class="modal-header bg-primary text-white py-3">
            <h5 class="modal-title py-1" id="formModalLabel">ลงทะเบียน</h5>
            <button type="button" class="btn-close text-white" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form id="register_patient_form">
              <div class="mb-3">
                <label for="name" class="form-label">ชื่อ</label>
                <input type="text" class="form-control" id="name" placeholder="กรอกชื่อของคุณ" />
              </div>
              <div class="mb-3">
                <label for="email" class="form-label">อีเมล</label>
                <input type="email" class="form-control" id="email" placeholder="example@mail.com" />
              </div>
              <div class="mb-3">
                <label for="password" class="form-label">รหัสผ่าน</label>
                <input type="password" class="form-control" id="password" placeholder="********" />
              </div>
              <button type="submit" class="btn btn-success w-100">สมัครสมาชิก</button>
            </form>
          </div>
        </div>
      </div>
    </div>

    <!-- หน้าหลัก, หน้าย่อย -->
    <script>
      const btnPageChild = $('.btn-menu-child-page,  .list-menu-page');
      var currentMainPage = 'homepage';
      var currentChildPage = null;

      $(document).ready(function () {
        $(`#${currentMainPage}`).fadeIn(500, function () {
          $(`#${currentChildPage}`).fadeIn(500);
        });

        btnPageChild.click(function () {
          const mainPageId = $(this).data('main-page-id');
          const childPageId = $(this).data('child-page-id');

          if (mainPageId && mainPageId != currentMainPage) {
            currentMainPage = mainPageId;

            $('.main-page').hide();
            $(`#${currentMainPage}`).fadeIn(300, function () {
              currentChildPage = childPageId;
              $('.child-page').hide();
              $(`#${currentChildPage}`).fadeIn(500);
            });
          } else if (childPageId != currentChildPage) {
            currentChildPage = childPageId;
            $('.child-page').hide();
            $(`#${currentChildPage}`).fadeIn(500);
          }
        });
      });
    </script>

    <!-- แถบนำทาง -->
    <script>
      $(document).ready(function () {
        initializeSidebar();
      });

      function initializeSidebar() {
        $('.sidebar-dropdown-menu').slideUp('fast');

        $('.sidebar-menu-item.has-dropdown > a, .sidebar-dropdown-menu-item.has-dropdown > a').click(function (e) {
          e.preventDefault();
          if (!$(this).parent().hasClass('focused')) {
            $(this).parent().parent().find('.sidebar-dropdown-menu').slideUp('fast');
            $(this).parent().parent().find('.has-dropdown').removeClass('focused');
          }
          $(this).next().slideToggle('fast');
          $(this).parent().toggleClass('focused');
        });

        $('.sidebar-toggle').click(function () {
          $('.sidebar').toggleClass('collapsed');
        });

        $('.sidebar-overlay').click(function () {
          $('.sidebar').addClass('collapsed');
          $('.sidebar-dropdown-menu').slideUp('fast');
          $('.sidebar-menu-item.has-dropdown, .sidebar-dropdown-menu-item.has-dropdown').removeClass('focused');
        });

        if (window.innerWidth < 768) {
          $('.sidebar').addClass('collapsed');
        }
      }
    </script>

    <!-- ตั้งค่าตาราง -->
    <script>
      const _emptyTable = `<div class="d-flex flex-column align-items-center">
                  <i class="bi bi-inbox fs-1 text-muted mb-3"></i>
                  <h5 class="text-muted mb-1">ไม่พบข้อมูล</h5>
                  <p class="text-muted small mb-0">ยังไม่มีข้อมูลผู้ใช้งาน</p>
                </div>`;

      const _sZeroRecords = `<div class="d-flex flex-column align-items-center">
        <i class="bi bi-inbox fs-1 text-muted mb-3"></i>
        <h5 class="text-muted mb-1">ไม่พบข้อมูล</h5>
        <p class="text-muted small mb-0">ข้อมูลค้นหาไม่ตรงกับฐานข้อมูล</p>
      </div>`;

      const settings = {
        // กำหนดเมนูแสดงจำนวนแถว
        lengthMenu: [
          [5, 10, 15, 20, 50, 100, -1],
          [5, 10, 15, 20, 50, 100, 'ทั้งหมด'],
        ],

        order: [[1, 'desc']],
        ordering: true,
        iDisplayLength: 20,
        responsive: true,
        scrollX: true,

        columnDefs: [{ orderable: false, targets: 0 }],
        autoWidth: true, // ✅ เปิดให้ปรับขนาดอัตโนมัติ

        //เมนูภาษาไทย
        language: {
          sProcessing: 'กำลังดำเนินการ...',
          sLengthMenu: 'แสดง _MENU_ รายการ',
          sZeroRecords: _sZeroRecords,
          sInfo: 'แสดง _START_ ถึง _END_ จาก _TOTAL_ รายการ',
          sInfoEmpty: 'แสดง 0 ถึง 0 จาก 0 รายการ',
          sInfoFiltered: '(กรองข้อมูลจาก _MAX_ รายการ)',
          sInfoPostFix: '',
          sSearch: 'ค้นหา:',
          sUrl: '',
          emptyTable: _emptyTable,

          // oPaginate: {
          //   sFirst: "หน้าแรก",
          //   sPrevious: "ก่อนหน้า",
          //   sNext: "ถัดไป",
          //   sLast: "หน้าสุดท้าย",
          // },
        },
      };
    </script>

    <!-- ตารางข้อมูล -->
    <script>
      function idCardFormatter(cardId) {
        const id = `${cardId}`;
        console.log(id.length());
        return (formatted = `${id[0]} ${id.slice(1, 5)} ${id.slice(5, 10)} ${id.slice(10, 12)} ${id.slice(12)}`);
      }

      var table = null;
      var count = 0;

      // เพิ่มข้อมูลใหม่
      const img = '<img class="profile-table" src="https://lh5.googleusercontent.com/d/14JrOi6I2qanUTFn4Q_ftHDDkrGGSw8iV" alt />';
      const newData = [img, 'user_name', 'รอดำเนินการ', 'user_', 'user_w', 'หญิง', `${20 + count} ปี`];

      $(document).ready(function () {
        table = new Table('#main_user_data_table', { ...settings });

        // Event เมื่อเลือกรายการจากตาราง
        table.getTable().on('click', 'tbody tr.data-table-row', function () {
          // ดึงข้อมูลแถวที่เลือก
          const data = table.getRowData(this);
          console.log(data);
          patientHistory();
        });

        function patientHistory() {
          currentMainPage = 'patientInformation';
          currentChildPage = 'patientInformation_1';
          $('.main-page').hide();
          $('.section-user-data').slideDown();

          $(`#${currentMainPage}`).fadeIn(300, function () {
            $('.child-page').hide();
            $(`#${currentChildPage}`).fadeIn(500);
          });
        }

        $('.list-menu-page[data-main-page-id="homepage"]').click(function () {
          currentMainPage = 'homepage';
          currentChildPage = '';
          $('.main-page').hide();
          $(`#${currentMainPage}`).fadeIn('fast');
          $('.section-user-data').slideUp();
        });
      });

      class Table {
        constructor(tableId, settings, data = []) {
          this.tableId = tableId;
          this.settings = settings;
          this.table = new DataTable(tableId, { ...settings });
          this.data = data;
        }

        getTable() {
          return this.table;
        }
        // ดึงข้อมูลแถว
        getRowData(row) {
          return this.table.row(row).data();
        }
        // เพิ่มแถวข้อมูล
        addRow(data) {
          this.data.push(data);
          let row = this.table.row.add(data).draw().node(); // ดึง `node()` ของแถวที่เพิ่ม

          // เพิ่มคลาสให้แถวใหม่มีเอฟเฟกต์
          $(row).css('opacity', 0).animate({ opacity: 1 }, 500); // เอฟเฟกต์ fade-in
        }
        // แก้ไขแถวข้อมูล
        updateRow(rowIndex, data) {
          this.data[rowIndex] = data;
          this.table.row(rowIndex).data(data).draw();
        }
        // ลบแถวข้อมูล
        deleteRow(rowIndex) {
          this.data.splice(rowIndex, 1);
          this.table.row(rowIndex).remove().draw();
        }
        // จำนวนแถว
        getLength() {
          return this.table.rows().count();
        }
        // ค้นหาข้อมูล
        search(searchQuery) {
          this.table.search(searchQuery).draw();
        }
        //  เรียงข้อมูลตามคลอลั่ม
        sortColumn(columnIndex, order) {
          this.table.order([columnIndex, order]).draw();
        }
        // ดาวโหลด Excel
        exportToExcel() {
          const blob = new Blob([this.table.table().html()], { type: 'text/html' });
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = 'report.xlsx';
          a.click();
          URL.revokeObjectURL(url);
          a.remove();
        }
        // ดาวโหลด CSV
        exportToCSV() {
          const csv = this.table
            .table()
            .rows()
            .data()
            .map((row) => row.map((cell) => escapeHtml(cell)).join(','))
            .join('\n');
          const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });
          const url = URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = url;
          a.download = 'report.csv';
          a.click();
          URL.revokeObjectURL(url);
          a.remove();
        }
        // ล้างข้อมูลตาราง
        clearTable() {
          this.data = [];
          this.table.clear().draw();
        }
      }

      function getStatusBadgeClass(status) {
        return (
          {
            Pending: 'bg-warning',
            Approved: 'bg-success',
            Rejected: 'bg-danger',
            Inactive: 'bg-secondary',
          }[status] || 'bg-secondary'
        );
      }

      function formatDate(dateString) {
        if (!dateString) return '-';
        const date = new Date(dateString);
        if (isNaN(date.getTime())) return dateString;

        return date.toLocaleString('th-TH', {
          year: 'numeric',
          month: 'long',
          day: 'numeric',
          hour: '2-digit',
          minute: '2-digit',
        });
      }

      function escapeHtml(unsafe) {
        return unsafe
          ? String(unsafe).replace(/&/g, '&amp;').replace(/</g, '&lt;').replace(/>/g, '&gt;').replace(/"/g, '&quot;').replace(/'/g, '&#039;')
          : '';
      }
    </script>

    <script>
      $(document).ready(function () {
        //  กรองข้อมูลเฉพาะคลอลั่ม
        $('input.table_filter').on('keyup click', function () {
          const val = $(this).val();
          table.search(val);
        });

        //  กรองข้อมูลเฉพาะคลอลั่ม
        $('input.column_filter, select.column_filter').on('keyup click change', function () {
          filterColumn($(this).parents('tr').attr('data-column'));
        });

        //  กรองข้อมูลเฉพาะคลอลั่ม **เฉพาะคำที่ตรงกันจริงๆ**
        $('select.column_filter_same').on('change', function () {
          filterColumnSame($(this).parents('div').attr('data-column'));
        });

        $('.ui-menu').on('click', (event) => {
          const val = event.target.innerHTML;
          table.getTable().DataTable().column(1).search(val).draw();
        });

        // รีเซ็ตการกรองข้อมูล
        $('#reset_filter').on('click', (event) => {
          $('input.table_filter').val('');
          $('input.column_filter, select.column_filter, input.mc-date-picker').val('');
          $('select.column_filter_same').val('');

          table.getTable().search('');
          table.getTable().columns('').search('').draw();
        });

        //  กรองข้อมูลเฉพาะคลอลั่ม
        function filterColumn(column) {
          const val = $('#col' + column + '_filter').val();
          table.getTable().column(column).search(val).draw();
        }

        //  กรองข้อมูลเฉพาะคลอลั่ม **เฉพาะคำที่ตรงกันจริงๆ**
        function filterColumnSame(column) {
          const val = $('#col' + column + '_filter').val();
          table
            .getTable()
            .column(column - 1)
            .search(val ? '^' + val + '$' : '', true, false)
            .draw();
        }
      });
    </script>

    <!-- MCDatepicker -->
    <script>
      $(document).ready(function () {
        // ตั้งค่าปฏิทิน
        const monthNames = [
          'มกราคม',
          'กุมภาพันธ์',
          'มีนาคม',
          'เมษายน',
          'พฤษภาคม',
          'มิถุนายน',
          'กรกฎาคม',
          'สิงหาคม',
          'กันยายน',
          'ตุลาคม',
          'พฤศจิกายน',
          'ธันวาคม',
        ];
        const dayNames = ['อา.', 'จ.', 'อ.', 'พ.', 'พฤ.', 'ศ.', 'ส.'];
        const datepicker_settings = {
          bodyType: 'modal',
          selectedDate: new Date(),
          dateFormat: 'dd/mm/yyyy',
          customMonths: monthNames,
          customWeekDays: dayNames,
          closeOnBlur: true,
          autoClose: true,
          // minDate: new Date(dateFormat(<?= minDate ?>)),
          // maxDate: new Date(dateFormat(<?= maxDate ?>)),
        };

        const filter_sDate_el = '#service_start_date';
        const filter_eDate_el = '#until_the_date_of_service';

        const sDatePicker = MCDatepicker.create({
          el: filter_sDate_el,
          ...datepicker_settings,
        });

        const eDatePicker = MCDatepicker.create({
          el: filter_eDate_el,
          ...datepicker_settings,
        });

        sDatePicker.onSelect((date, formatedDate) => {
          table.getTable().draw();
          const sDate = new Date(date);
          const eDate = new Date(eDatePicker.pickedDate);
          if (sDate > eDate && $(filter_eDate_el).val()) {
            eDatePicker.setFullDate(sDate);
          }

          eDatePicker.prevLimitDate = date;
          // console.log(eDatePicker)
        });

        eDatePicker.onSelect((date, formatedDate) => {
          table.getTable().draw();
        });

        // Custom filtering function which will search data in column four between two values
        DataTable.ext.search.push(function (settings, data, dataIndex) {
          const sDate = dateFormat($(filter_sDate_el).val());
          const eDate = dateFormat($(filter_eDate_el).val());
          const col_filter = 1;

          const date = dateFormat(data[col_filter]);
          if (!sDate || !eDate) return true;

          if (date >= sDate && date <= eDate) return true;

          return false;
        });

        // convert dd/mm/yyyy to yyyy/mm/dd
        function dateFormat(date) {
          if (!date) return;
          const _date = date.split(', ')[0];
          const dd = _date.split('/')[0];
          const mm = _date.split('/')[1];
          const yyyy = _date.split('/')[2];
          const iso_date = new Date([yyyy, mm, dd].join('-'));
          return iso_date;
        }
      });
    </script>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11.0.19/dist/sweetalert2.all.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.6.0/jspdf.plugin.autotable.min.js"></script>
  </body>
</html>
