<script>
  // Setting.js
  $(document).ready(function () {
    // No event handlers related to academicYears are needed
  });

  function showSettingsModal() {
    loadSettings();
    $('#settingsModal').modal('show');
  }

  function loadSettings() {
    Swal.fire({
      title: 'กำลังโหลดการตั้งค่า',
      text: 'กรุณารอสักครู่...',
      allowOutsideClick: false,
      didOpen: () => {
        Swal.showLoading();
      },
    });

    google.script.run
      .withSuccessHandler(function (settings) {
        $('#sheetId').val(settings.SHEET_ID || '');
        $('#folderId').val(settings.PROFILE_IMAGES_FOLDER_ID || '');

        Swal.close();
      })
      .withFailureHandler(function (error) {
        console.error('Error loading settings:', error);
        Swal.fire({
          icon: 'error',
          title: 'เกิดข้อผิดพลาด',
          text: 'ไม่สามารถโหลดการตั้งค่าได้: ' + error,
        });
      })
      .getSettings();
  }

  function saveSettings() {
    const settings = {
      SHEET_ID: $('#sheetId').val(),
      PROFILE_IMAGES_FOLDER_ID: $('#folderId').val(),
    };

    Swal.fire({
      title: 'ยืนยันการบันทึกการตั้งค่า',
      text: 'คุณแน่ใจหรือไม่ที่จะบันทึกการตั้งค่านี้?',
      icon: 'warning',
      showCancelButton: true,
      confirmButtonColor: '#3085d6',
      cancelButtonColor: '#d33',
      confirmButtonText: 'ใช่, บันทึกเลย!',
      cancelButtonText: 'ยกเลิก',
    }).then((result) => {
      if (result.isConfirmed) {
        Swal.fire({
          title: 'กำลังบันทึกการตั้งค่า',
          text: 'กรุณารอสักครู่...',
          allowOutsideClick: false,
          didOpen: () => {
            Swal.showLoading();
          },
        });

        google.script.run
          .withSuccessHandler(function () {
            Swal.fire({
              icon: 'success',
              title: 'บันทึกสำเร็จ!',
              text: 'การตั้งค่าของคุณได้ถูกบันทึกเรียบร้อยแล้ว',
            });
            $('#settingsModal').modal('hide');
          })
          .withFailureHandler(function (error) {
            console.error('Error saving settings:', error);
            Swal.fire({
              icon: 'error',
              title: 'เกิดข้อผิดพลาด',
              text: 'ไม่สามารถบันทึกการตั้งค่าได้: ' + error,
            });
          })
          .saveSettings(settings);
      }
    });
  }
</script>
